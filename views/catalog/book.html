{{extend 'layout.html'}}

<div id="main" class="container">

<section id="content">
  <div style="height: 20px"></div>
  <div class="container">
    <div class="row">
      <div class="col-lg-3">
        <article>
          <div class="post-image">
            {{=IMG(_src=cover_image)}}
          </div>
        </article>
        <div class="box">
          <div class="box-gray alignleft" style="height: auto;">

            <h5 style="color: #656565; margin-bottom: 0.5em;">{{=T('How to cite this title')}}</h5>
            <p>
			{{if editors:}}
			  {{contributors=editors}}
			  {{if len(editors)==1:}}
			    {{format_string="{}, "+T('ed')+"."}}
			  {{else:}}
			    {{format_string="{} "+T('and')+" {}, "+T('eds')+"."}}
			  {{pass}}
			{{elif authors:}}
	                  {{contributors=authors}}
	                  {{if len(authors) == 1:}}
	                    {{format_string="{}."}}
	                  {{else:}}
	                    {{format_string="{} "+T('and')+" {}."}}
	                  {{pass}}
			{{pass}}
			{{if len(contributors)==1:}}
			  {{e=contributors[0]}}
			  {{=format_string.format(e.last_name+", "+" ".join([e.first_name, e.middle_name]).strip())}}
			{{elif len(contributors) == 2:}}
	                  {{last=contributors[-1]}}
	                  {{contributors=contributors[:-1]}}
	                  {{=format_string.format(T(', ').join([e.last_name+", "+" ".join([e.first_name, e.middle_name]).strip() for e in contributors]), " ".join([last.first_name, last.middle_name]).strip()+" "+last.last_name)}}
			{{elif len(contributors) > 2:}}
			  {{first=contributors[0]}}
			  {{second=contributors[1]}}
			  {{last=contributors[2]}}
			  {{if len(contributors) > 3:}}
			    {{add="et al"}}
			  {{else:}}
			    {{add=""}}
			  {{pass}}
			  {{=format_string.format(T(', ').join([first.last_name+", "+" ".join([first.first_name, first.middle_name]).strip(), 
											" ".join([second.first_name, second.middle_name]).strip()+" "+second.last_name]), 
								" ".join([last.first_name, last.middle_name]).strip()+" "+last.last_name)+add}}
			{{pass}}
            <i>{{=cleanTitle}}
            	{{if len(subtitle)>0:}}
                : {{=subtitle}}
                {{pass}}
            </i>
              {{=press_name}},
            </p>
            {{if doi:}}
            <p>
              DOI: <a href="http://dx.doi.org/{{=doi}}" title="DOI: {{=cleanTitle}}, {{=press_name}}, 2015">{{=doi}}</a>
            </p>
            {{pass}}
<!--            <h5 style="color: #656565; margin-bottom: 0.3em;">{{=T('Licenses')}}</h5>
           {{if session.forced_language =='de': }}
            <p>Dieses Werk ist unter der<br> <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.de" title="Homepage Creative Commons; Lizenz CC BY-SA 4.0">Creative Commons-Lizenz 4.0<br/> (CC BY-SA 4.0)</a> ver√∂ffentlicht.<br>
              <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.de" title="Homepage Creative Commons; Lizenz CC BY-SA 4.0"><img alt="Creative Commons Lizenz BY-SA 4.0" src="/static/images/catalog/cc_by-sa-4-0_88x31.png" /></a></p>
            {{elif session.forced_language =='en': }}
            <p>This work is licensed under a <a href="http://creativecommons.org/licenses/by-sa/4.0/" title="Homepage Creative Commons; License CC BY-SA 4.0">Creative Commons License 4.0<br/> (CC BY-SA 4.0)</a> .<br>
              <a href="https://creativecommons.org/licenses/by-sa/4.0/" title="Homepage Creative Commons; Lizenz CC BY-SA 4.0"><img alt="Creative Commons License BY-SA 4.0" src="/static/images/catalog/cc_by-sa-4-0_88x31.png" /></a></p>
            {{pass}}-->
            {{if len(identification_codes)>0:}}
            <h5 style="color: #656565; margin-bottom: 0.3em; margin-top: 1.2em;">ISBN</h5>
            <p>
              {{for i in identification_codes:}}
                {{=i}} ({{=identification_codes[i]}})
              <br>
              {{pass}}
            </p>
            {{pass}}
            <!--<p><B>Statistik</B></p>-->
            {{if published_date:}}
            <p>{{=T('Published')}} {{=published_date.first()['date'][6:8]}}.{{=published_date.first()['date'][4:6]}}.{{=published_date.first()['date'][0:4]}}</p>
            {{pass}}
             <!---a data-toggle="modal" class="btn btn-info" href="../../../cgi-bin/oastats.cgi?repo=omphp" data-target="#myModal">{{=T('')}}</a-->
           <div id="oas-widget" class="applied-to-ojs">
           <div class="btn btn-default" id="statistik-button">{{=T('Statistics since 07.03.16')}}</div> <br/>
           <div style="display:none" class="table" id="oas">
             
              <ul class="nav nav-tabs">
                     <li class="active"><a href="#one2" data-toggle="tab"><i class="icon-briefcase"></i> {{=T('Book')}}</a></li>
                     <li class=""><a href="#two2" data-toggle="tab">{{=T('Chapters')}}</a></li>
                   </ul>
                   <div class="tab-content">
                     <div class="tab-pane active" id="one2">
                       <table class="table">
                         {{file_ids=[]}}
                          {{for fullbook in full_files:}}
                          {{file_id=str(fullbook['submission_id'])+'-'+str(fullbook['file_id'])+'-'+fullbook['original_file_name'].rsplit('.')[1].lower()}}
                          {{if fullbook['original_file_name'].rsplit('.')[1].lower()==myconf.take('omp.xml_category_name').lower():}}     
                            {{=TR()}}
                              {{=TD(B(XML('HTML')))}}
                              
                              {{=TD(DIV("",_id=file_id))}}
                              {{full_xml=file_id}}
                          {{else:}}
                            {{=TR()}}
                              {{=TD(B('PDF'))}}
                              {{=TD(DIV("",_id=file_id))}}
                              {{full_pdf=file_id}}
                          {{pass}}
                          {{file_ids.append(file_id)}}
                        
                          {{pass}}
                       </table>
                     </div>
                     <div class="tab-pane " id="two2">
                       <table class="table" style="width: inherit">
                          {{type_dict={} }}
                          {{=TR()}}
                          {{=TD()}}
                          {{for ix  in publication_formats:}}
                          {{type_dict[ix.publication_formats.publication_format_id]=ix.publication_format_settings.setting_value}}
                          {{if ix.publication_format_settings.setting_value == myconf.take('omp.xml_category_name'):}}
                          {{=TD(XML('HTML'),_style="padding:0")}}
                          {{else:}}
                          {{type_dict[ix.publication_formats.publication_format_id]=ix.publication_format_settings.setting_value}}
                          {{=TD(ix.publication_format_settings.setting_value, _style="padding:0")}}
                          {{pass}}
                          {{pass}}
                          {{num=0}}
                          {{for i in chapters:}}
                          
                           {{if num%len(publication_formats)==0: }}
                          {{=TR()}}
                          {{chapter=str(i.submission_chapter_settings.setting_value)}}
                          {{=TD(chapter,_style="padding:0; font-size:12px")}}
                          {{pass}}
                           {{
                            chapter_file =str(i.submission_files.submission_id)+'-'+str(i.submission_files.file_id)+'-'+str(type_dict[i.submission_files.assoc_id]).lower() 
                           =TD(DIV("",_id=chapter_file),_style="padding:1; font-size:12px")
                           file_ids.append(chapter_file)
                           }}
                          {{num = num +1 }}
                          {{pass}}
                          <tr>
                            <td>{{=B(T('Total'))}}</td>
                           {{=TD(DIV("",_id="chapter_pdf"))}}
                           {{=TD(DIV("",_id="chapter_xml"))}}
                          </tr>
                        </table>
                     </div>
                    </div>
             
           </div>
           
           <div id="error"></div>
            </div>

          </div>

        </div>
      </div>
      <div class="col-lg-9">
        <article>
          <div class="">
            <div class="btn-group" role="group" aria-label="1">
              {{for fullbook in full_files:}}
                {{if fullbook['original_file_name'].rsplit('.')[1].lower()==myconf.take('omp.xml_category_name').lower():}}
              
                <li type="button" class="btn btn-default"><a href="{{=URL(myconf.take('web.application'), 'reader', 'index/'+str(fullbook['submission_id'])+'/'+str(fullbook['submission_id'])+'-'+str(fullbook['genre_id'])+'-'+str(fullbook['file_id'])+'-'+str(fullbook['revision'])+'-'+str(fullbook['file_stage'])+'-'+str(fullbook["date_uploaded"].strftime('%Y%m%d'))+'.'+str(fullbook['original_file_name']).rsplit('.')[1])}}" target="_blank">{{=T('Read')}}</a></li>
                {{pass}}
              {{pass}}
            </div>
            <div class="btn-group" role="group" aria-label="2">
              {{for fullbook in full_files:}}
              {{if fullbook['original_file_name'].rsplit('.')[1].lower()==myconf.take('omp.doi_format_name').lower():}}
              
              <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true">
                {{=T('Download')}}
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                <li role="presentation"><a role="menuitem" tabindex="-1"  href="{{=URL(myconf.take('web.application'), 'reader', 'download/'+str(fullbook['submission_id'])+'/'+str(fullbook['submission_id'])+'-'+str(fullbook['genre_id'])+'-'+str(fullbook['file_id'])+'-'+str(fullbook['revision'])+'-'+str(fullbook['file_stage'])+'-'+str(fullbook["date_uploaded"].strftime('%Y%m%d'))+'.'+str(fullbook['original_file_name']).rsplit('.')[1])}}">PDF</a></li>
              </ul>
              {{pass}}
              {{pass}}
            </div>
            <div class="btn-group" role="group" aria-label="2">
	       {{if representatives:}}
              <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true">
                {{=T('Print On Demand')}}
                <span class="caret"></span>
              </button>
		{{pass}}
              <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                {{for i in representatives:}}
                <li role="presentation"><a role="menuitem"  href="{{=i['url']}}" target='_blank'>{{=i['name']}}</a></li>
                {{pass}}
              </ul>
            </div>
            <div class="post-heading">
              <br/>
              <h5>
              {{if editors:}}
		      	{{=", ".join([" ".join([e.first_name, e.middle_name, e.last_name]) for e in editors[:3]])}}
		      	{{if len(editors) > 1:}}
					{{if len(editors) > 3:}}
						{{=" et al. "}}
					{{pass}}
					{{=T("(eds)")}}
		      	{{else:}}
					{{=T("(ed.)")}}
		      	{{pass}}
		   	  {{else:}}
		      	{{=", ".join([" ".join([e.first_name, e.middle_name, e.last_name]) for e in authors[:3]])}}
		      	{{if len(authors) > 3:}}
					{{=" et al. "}}
				{{pass}}
		   	  {{pass}}
              </h5>
            </div>
            <h3>{{=XML(cleanTitle)}}</h3>
            <h4>{{=subtitle}}</h4>
            <p>
              <i class="icon-quote-left"></i>
              {{=XML(abstract)}}
            </p>
	   	  {{if bio["editors"]:}}
	   	  	{{num_bios = len([b for b in bio["editors"] if b != ""])}}
            {{if num_bios != 0:}}
            	<p>
            		<h5>
            		{{if num_bios == 1:}}
            			{{=T('About the editor:')}}
            		{{else:}}
            			{{=T('About the editors:')}}
            		{{pass}}
            		</h5>
            		{{=XML("<br>".join(bio["editors"]))}}
            	</p>
            {{pass}}
	   	  {{elif bio["authors"]:}}
	   	  	{{num_bios = len([b for b in bio["authors"] if b != ""])}}
            {{if num_bios != 0:}}
            	<p>
            		<h5>
            		{{if num_bios == 1:}}
            			{{=T('About the author:')}}
            		{{else:}}
            			{{=T('About the authors:')}}
            		{{pass}}
            		</h5>
            		{{=XML("<br>".join(bio["authors"]))}}
            	</p>
            {{pass}}
          {{pass}}
          </div>
          <div class="widget">
            <h5 class="widgetheading"></h5>
            <ul class="tags">
            </ul>
          </div>
          <div class="widget">
            <!---a class="btn btn-default" data-toggle="collapse" href="#collapseExample" aria-expanded="false" aria-controls="collapseExample"-->

            {{if len(chapters)>0:}}
            <h4>{{=T('Contents')}} </h4>
            <div  id="downloadTable">
              <table class="table">
                {{type_dict={} }}
                {{=TR()}}
                {{=TD()}}
                {{for i  in publication_formats:}}
                {{if i.publication_format_settings.setting_value == myconf.take('omp.xml_category_name'):}}
                {{=TD('HTML')}}
                {{else:}}
                {{=TD(i.publication_format_settings.setting_value)}}
                {{pass}}
                {{type_dict[i.publication_formats.publication_format_id]=i.publication_format_settings.setting_value}}
                {{pass}}
                {{num=0}}
                {{for i in chapters:}}
                {{if num%len(publication_formats)==0: }}
                {{=TR()}}
                {{=TD(str(i.submission_chapter_settings.setting_value))}}
                {{pass}}
                {{if str(type_dict[i.submission_files.assoc_id]).lower() ==  myconf.take('omp.xml_category_name').lower(): }}
                {{=TD(A(I(_class="fa fa-html5"), _href=URL(myconf.take('web.application'), 'reader', 'index/'+str(i.submission_files.submission_id)+'/'+str(i.submission_files.submission_id)+'-'+str(i.submission_files.genre_id)+'-'+str(i.submission_files.file_id)+'-'+str(i.submission_files.revision)+'-'+str(i.submission_files.file_stage)+'-'+str(i.submission_files.date_uploaded.strftime('%Y%m%d'))+'.'+str(type_dict[i.submission_files.assoc_id]).lower())))}}
                {{else:}}
                {{=TD(A(I(_class="fa fa-file-text-o"), _href=URL(myconf.take('web.application'), 'reader', 'download/'+str(i.submission_files.submission_id)+'/'+str(i.submission_files.submission_id)+'-'+str(i.submission_files.genre_id)+'-'+str(i.submission_files.file_id)+'-'+str(i.submission_files.revision)+'-'+str(i.submission_files.file_stage)+'-'+str(i.submission_files.date_uploaded.strftime('%Y%m%d'))+'.'+str(type_dict[i.submission_files.assoc_id]).lower())))}}
                {{pass}}
                {{num = num +1 }}
                {{pass}}
              </table>
            </div>
            {{pass}}
          </div>
        </article>
      </div>
    </div>
  </div>
</div>
</section>
<script>
  var ids={{=XML(file_ids)}};
  var full_xml, full_pdf;
   {{ if 'full_xml' in  locals():}}
    full_xml = "{{=full_xml}}";
  {{pass}}
  {{ if 'full_pdf' in  locals():}}
    full_pdf= "{{=full_pdf}}";
  {{pass}}


</script>
<script src="{{=URL(myconf.take('web.application'),'static','js/stats.js')}}" data-ids="{{=XML(file_ids)}}" data-full_pdf=full_pdf data-full_xml=full_xml ></script>
